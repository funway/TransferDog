<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>TransferDog Manual (English)</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-interactiveBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="07011477-3dc5-4681-9058-528898a8d57d" class="page sans"><header><img class="page-cover-image" src="https://images.unsplash.com/photo-1608496601160-f86d19a44f9f?ixlib=rb-4.0.3&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb" style="object-position:center 50%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">🐶</span></div><h1 class="page-title">TransferDog Manual (English)</h1><p class="page-description"></p></header><div class="page-body"><p id="ac292832-a8af-4f39-8d44-edfff855f974" class="">English / <a href="manual_zh.html">中文</a></p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="e00b4eeb-c2e9-4658-95b7-30b74a47ddd8"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><strong>TransferDog</strong> is a file transfer program written in Python. It helps you collect files from a source address and send them to a destination address at regular intervals. The source and destination addresses can be local directories or FTP, FTPS, SFTP servers.</div></figure><nav id="4fcfc7e1-b9d2-4dbe-9976-6511798716a4" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#12a42f39-6354-460b-a19b-e395f7be839f">⭐ <strong><strong>Getting Started</strong></strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1956f846-22dc-4f7a-bc8c-d0a48c096df4">Running Program</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#3d988a05-7c61-46a3-86cf-4b3343187a37">From source code</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#ff2cf3c7-cf54-4efd-9794-c87d3d58abb0">From packaged version</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#adb43ef6-91b5-409c-b2c3-f8f1baced2e3">Program user interface</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#e5422d1a-589c-4544-9e25-8d5e5e9ad163">Main window</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#5345e603-b455-4d76-97b0-bdad80dba258">Task Edit Dialog</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#381c509e-4d47-420e-8042-0c5e462084a9">Regular Expression Testing Dialog</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#bf5c1ce1-12a3-4be3-bef1-7c3dd0e67a84">Settings Dialog</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#28c0c3b5-b55f-4853-bd70-1b9f2a6331cb">Task Scheduling</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#af6b91b3-6aef-4e3a-8fd9-5ea5ae280549">Scheduling Logic in Main Process</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#f8f629aa-c555-416c-af5a-160b2b283937">Task Scheduling</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#6d73c707-cd82-487d-bb95-0dca68f23e2a">Filter and Middleware</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#4b1db93e-e3f5-4adc-8a98-05480ac584fa">Regular Expression</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#3ccc9156-4277-4eee-a7b8-84c2f5434285">Middleware</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#56e0014b-3218-4869-a796-19b04603b681">💻 Code Structure</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#07749345-6377-4755-a8a5-a964183f360b">Overview</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#61f1b171-7a58-4862-b2fe-44a71e9b6659">transfer_dog Package</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#9b957101-b8ea-4338-9f57-e8570f977da2">Multi-Language</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#14f0ad88-126a-4702-87d4-069d83227c82">Themes</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3d7d340f-696f-4f05-91cc-b0096d00fa9b">transfer_worker Pacakge</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#e35f3c78-81aa-4abf-9224-c9bd2c95e16f">Execution Logic</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#7087254c-99b7-414e-98eb-4de64cf4a81e">Middleware Developing</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#7e11a031-753d-4f5d-8904-43fc34db4e43">🎁 Thanks to</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#570f86ed-cb43-4877-aeac-ffb31285b11d">Third-party Libraries</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#29331f64-247f-4c2e-b44f-22287bcc2f4e">Resource files</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#06d96695-d53b-408f-b70b-a70cb3ddb60b">📝 Todo list</a></div></nav><h1 id="12a42f39-6354-460b-a19b-e395f7be839f" class="">⭐ <strong><strong>Getting Started</strong></strong></h1><h2 id="1956f846-22dc-4f7a-bc8c-d0a48c096df4" class="">Running Program</h2><h3 id="3d988a05-7c61-46a3-86cf-4b3343187a37" class="">From source code</h3><p id="15740bc8-b6e9-432f-8f5e-5e8364cd0f38" class="">If you downloaded the source code of TransferDog, you can use the command line <code>python main.py</code> to run the program.</p><p id="9056813f-62dc-438f-aa1e-5489b77f26c1" class="">Before running the program, you need to make sure:</p><ol type="1" id="d1039173-e6b5-44b2-9036-cd34d1a6e1ad" class="numbered-list" start="1"><li>Python version ≥ 3.10</li></ol><ol type="1" id="45e71c6c-6be5-4b47-9b93-27fa03a2cec2" class="numbered-list" start="2"><li>You have installed the required dependencies in the <code>requirements.txt</code> file. This can be done with the command <code>pip install -r requirements.txt</code>.</li></ol><h3 id="ff2cf3c7-cf54-4efd-9794-c87d3d58abb0" class="">From packaged version</h3><p id="51094ca2-3d9d-400e-ae52-c37bb3e6ed1a" class="">If you have downloaded a packaged version of TransferDog, we&#x27;ve packaged the Python runtime environment and dependencies in the project directory.</p><p id="d782a137-82cb-4ccc-b50a-b92124b4c8b4" class="">You can run the TransferDog program by double-clicking on the main file (main.exe on Windows platforms) in the directory.</p><h2 id="adb43ef6-91b5-409c-b2c3-f8f1baced2e3" class="">Program user interface</h2><h3 id="e5422d1a-589c-4544-9e25-8d5e5e9ad163" class="">Main window</h3><figure id="69e0b126-f525-44df-9301-624117999d6c" class="image"><a href="img/SCR-20230715-lqul.png"><img style="width:720px" src="img/SCR-20230715-lqul.png"/></a></figure><p id="cf936cd2-d5f1-4028-83ef-d6195bca8cec" class="">The main window includes：</p><ol type="1" id="0dcf6faf-5f9c-44ea-936a-0a966a2e15ff" class="numbered-list" start="1"><li>Tool Bar, which displays the menus. Includes New Task, Edit Task, Copy Task, Delete Task, Start Task, Stop Task, Open Source Directory, Open Destination Directory, Open Task Log, Open Task Processing Record, Setting, Open Help File.</li></ol><ol type="1" id="ca361254-4420-40b0-90b5-464f568c3905" class="numbered-list" start="2"><li>Task List, which displays all transfer tasks, and you can filter tasks by the search bar at the top of the task list.</li></ol><ol type="1" id="6eddd3df-1e2c-4429-9d0e-6e922badd5f5" class="numbered-list" start="3"><li>Processed Log, displays the processed records of the currently selected task in the task list.</li></ol><ol type="1" id="6211deb4-1770-4532-9522-48d4c763acb1" class="numbered-list" start="4"><li>Status Bar, displays the running status or error message of the program.</li></ol><h3 id="5345e603-b455-4d76-97b0-bdad80dba258" class="">Task Edit Dialog</h3><figure id="a51eba07-538c-4108-a842-16bc8bfbccea" class="image"><a href="img/SCR-20230709-mmme.png"><img style="width:720px" src="img/SCR-20230709-mmme.png"/></a></figure><p id="cf45d177-1060-40f6-b4b4-89f198840b19" class="">
</p><p id="633c229c-fa42-402a-b86a-93cb0bfd5cb3" class="">The Task Edit Dialog pops up when you click the NewTask, EditTask, or CopyTask button in the Tool Bar, or when you double-click a task in the Task List.</p><ul id="888a6a7c-d25f-4dfd-814c-206c4867af34" class="bulleted-list"><li style="list-style-type:disc">General Group<p id="78c65848-56fb-492c-b0f6-c4cc87f9106f" class="">Set the task name, task group, task scheduling rules (using Crontab expressions), task timeout, and whether to enable the task.</p></li></ul><ul id="f12ba6fd-d849-4be8-856c-62a8cd1f5356" class="bulleted-list"><li style="list-style-type:disc">Source Group<p id="785c2be8-17a2-4007-9641-1f0253ec7fe2" class="">Set the source address of the transfer.</p></li></ul><ul id="735b6d9f-a148-46c8-93d0-188e7123a30a" class="bulleted-list"><li style="list-style-type:disc">Filter / Middleware Group<p id="844dc37c-66c6-4447-9285-41ee777d30b9" class="">Set the task&#x27;s source file name matching rules, source file expiration time, subdirectory recursion, middleware, temporary suffix for file transfer, and retention time for processed records.</p></li></ul><ul id="1437bcb4-2d86-4751-80cc-e361798898f6" class="bulleted-list"><li style="list-style-type:disc">Destination Group<p id="ff42f418-bbcf-43e3-8758-46b0114b3744" class="">Set the destination address of the transfer.</p></li></ul><h3 id="381c509e-4d47-420e-8042-0c5e462084a9" class="">Regular Expression Testing Dialog</h3><figure id="97e27d40-8abb-4957-adaa-c2364e9c2c78" class="image"><a href="img/SCR-20230709-mpsd.png"><img style="width:720px" src="img/SCR-20230709-mpsd.png"/></a></figure><p id="fa0d525f-bc71-441c-aac7-da9a9b4d67fd" class="">
</p><p id="58a1a582-36fe-4757-b4b7-a13af3877507" class="">After the source filename regular expression in the Task Edit Dialog, there is a Test button that opens the Regular Expression Testing Dialog. You can use this dialog to test the regular expression.</p><p id="1d2fea2b-1708-4411-9924-ee3f13a36697" class="">In the Input field, enter the names of the files to be matched, one filename per line. Enter your regular expression in the RegEx field. Click the start button to output the file names matched by the regular expression in the Output field.</p><h3 id="bf5c1ce1-12a3-4be3-bef1-7c3dd0e67a84" class="">Settings Dialog</h3><figure id="05441da3-46cc-4ad3-ab7a-4a304c2bd42e" class="image"><a href="img/SCR-20230713-oszk.png"><img style="width:624px" src="img/SCR-20230713-oszk.png"/></a></figure><p id="2544ed01-9a0f-45d1-bb67-7bc7a4fda005" class="">In the Settings Dialog, you could choose the language and theme for the program.</p><h2 id="28c0c3b5-b55f-4853-bd70-1b9f2a6331cb" class="">Task Scheduling</h2><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="2a5a0ea7-073a-4d43-a30a-c438d57b0e92"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">The TransferDog’s main process polls the list of tasks all the time and starts or stops them according to each task&#x27;s own configured task schedule and timeout. TransferDog runs tasks as subprocesses, not as threads.</div></figure><h3 id="af6b91b3-6aef-4e3a-8fd9-5ea5ae280549" class="">Scheduling Logic in Main Process</h3><ol type="1" id="7ca47d2e-77e3-419d-bf30-c6be53c602a4" class="numbered-list" start="1"><li>Poll the list of tasks.</li></ol><ol type="1" id="228c85b7-3f42-4590-8b69-4b85c7a888f3" class="numbered-list" start="2"><li>If a task reaches its execution time, start the task <mark class="highlight-red"><strong>subprocess</strong></mark> (the worker process).</li></ol><ol type="1" id="30afbf62-1b69-440e-bcf9-f1c2db597b4b" class="numbered-list" start="3"><li>if a task timeout is detected, kill the subprocess of this task.</li></ol><ol type="1" id="d68a2d5e-71cc-424f-b130-a7baecc558b8" class="numbered-list" start="4"><li>If the main process exits, the subprocess automatically detects that the parent process is dead and aborts itself.</li></ol><h3 id="f8f629aa-c555-416c-af5a-160b2b283937" class="">Task Scheduling</h3><ol type="1" id="375e0be7-db22-4a22-821f-249ff7268424" class="numbered-list" start="1"><li>TransferDog uses the crontab expression common to the Linux platform to schedule each task. That is, <code>* * * * *</code> for <code>minutes, hours, days, months, and days of the week</code>.</li></ol><ol type="1" id="308ee921-8754-4c31-897a-e22ab4c19f33" class="numbered-list" start="2"><li>crontab example：<ol type="a" id="bbd1a8ea-27ca-499b-8c29-a6af11b28b47" class="numbered-list" start="1"><li><code>*/5 * * * *</code> means run every 5 minutes.</li></ol><ol type="a" id="6a6d1c43-3781-4125-bf8c-07bd86f92a13" class="numbered-list" start="2"><li><code>2 4 * * mon,fri</code> means it runs every Monday and Friday at 04:02.</li></ol></li></ol><ol type="1" id="3af9e663-0d46-49f8-818d-24c9ba2c6e2c" class="numbered-list" start="3"><li>Thanks to the <a href="https://github.com/kiorky/croniter">croniter</a> library, TransferDog&#x27;s crontab expression also supports setting seconds in the sixth position. For example, <code>* * * * * */5</code> means run every 5 seconds.</li></ol><ol type="1" id="aaf99c8b-c08a-4665-9e68-43f0627dfa48" class="numbered-list" start="4"><li>We recommend a website to test your crontab expressions online：<a href="https://crontab.guru/">https://crontab.guru/</a></li></ol><h2 id="6d73c707-cd82-487d-bb95-0dca68f23e2a" class="">Filter and Middleware</h2><h3 id="4b1db93e-e3f5-4adc-8a98-05480ac584fa" class="">Regular Expression</h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="f5b4badf-e317-4e29-ad07-fd6c78ec8998"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Regular Expression matches a source file, which by default matches the full pathname of the source file. That is, <code>/path_to_file/filename.txt</code> is the whole path. So it is recommended to use the <code>$</code> sign to match the end.</div></figure><h3 id="3ccc9156-4277-4eee-a7b8-84c2f5434285" class="">Middleware</h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="56f22621-4609-4126-b44e-ddbb602d5f5b"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">TransferDog introduces the concept of middleware to modify the logic of collecting (downloading) and sending (uploading) files.</div></figure><ol type="1" id="81f995d8-d785-411a-a85d-72bb2ee2e37e" class="numbered-list" start="1"><li>By default, the program only provides two middleware modules, <code>example.py</code> and <code>init_processed.py</code>.</li></ol><ol type="1" id="d2c15aa9-2e9f-4173-aaf2-1ff44b5919fd" class="numbered-list" start="2"><li>You can find the middleware module files in the <code>plugin/middleware/</code> directory.</li></ol><ol type="1" id="1db57723-ade6-464a-84ef-343126201046" class="numbered-list" start="3"><li><code>example.py</code> does nothing but show you the structure of a middleware module.</li></ol><ol type="1" id="87142ea7-b4ec-4b50-95fd-4ca640eabd05" class="numbered-list" start="4"><li><code>init_processed.py</code> middleware takes over the execution logic after the source files have been filtered and before they are downloaded. It gives up on downloading and uploading the file but writes the file to the processed log. You can use it to initialize a task if it has too many files in the source directory and you don&#x27;t want to download those outdated files.</li></ol><ol type="1" id="7b443841-f1b9-45a7-b615-b59b04014ed5" class="numbered-list" start="5"><li>you can write your own middleware module and put it in the <code>plugin/middleware/</code> directory. As long as it meets our coding requirements for middleware (see example.py middleware).</li></ol><h1 id="56e0014b-3218-4869-a796-19b04603b681" class="">💻 Code Structure</h1><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="a7c13c24-3983-49be-902a-9a93b13b7c42"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">The TransferDog code consists of two main packages: <strong>transfer_dog</strong> and <strong>transfer_worker</strong>.</div></figure><h2 id="07749345-6377-4755-a8a5-a964183f360b" class="">Overview</h2><figure id="4210c1a4-9f10-4f76-986f-14ad57a93f8d" class="image"><a href="img/SCR-20230709-odoz.png"><img style="width:192px" src="img/SCR-20230709-odoz.png"/></a><figcaption>Project Structure</figcaption></figure><ul id="e43d2f0f-ee98-4e7c-a3e6-c5b7d558cdd3" class="bulleted-list"><li style="list-style-type:disc">main.py<p id="1b4ca4c9-1206-4828-813f-31a9efb1fdc1" class="">Entry file for the program GUI, calling the transfer_dog package.</p></li></ul><ul id="f81fc12a-f262-4e99-a4c7-6c479ffc551a" class="bulleted-list"><li style="list-style-type:disc">worker.py<p id="4d848f98-1dd4-4f82-b325-5574b7edca45" class="">Entry file for the worker process (task subprocess), calling the transfer_worker package.</p><p id="02bf29b4-8a74-40dc-93c6-5462ffb2959a" class="">The worker process can run independently of the GUI. You can run <code>python worker.py -h</code> to see its command line arguments. </p></li></ul><ul id="611c974d-3d0c-46dc-8f36-ca69d01208e3" class="bulleted-list"><li style="list-style-type:disc">transfer_dog/<p id="9dc156bc-56b2-452c-9309-e98474f4f61d" class="">This package is responsible for the application&#x27;s GUI and for scheduling tasks.</p></li></ul><ul id="665606e5-3b75-46bf-bf1e-779c25486655" class="bulleted-list"><li style="list-style-type:disc">transfer_worker/<p id="bed02d29-9cba-46af-8db1-1075acb4f1ba" class="">This package is responsible for the actual execution of transfer tasks.</p></li></ul><ul id="6dee86e4-bd88-488c-b618-d9a7f0b2574f" class="bulleted-list"><li style="list-style-type:disc">conf/<p id="17022588-3bf1-4658-ad97-731f308380b5" class="">The directory where the configuration files are located. Includes log configuration and task configuration.</p><p id="0743afe6-919a-44d7-aba3-06c670728be8" class="">Configuration files are UTF8 encoded, so be aware of this when editing or modifying configuration files in Windows platform.</p></li></ul><ul id="fdbc9284-48e7-4d73-a8b4-17739a458ade" class="bulleted-list"><li style="list-style-type:disc">designer/<p id="1e33ad80-615d-4b81-8831-29315efc3541" class="">Holds the UI design files generated by Qt Designer.</p></li></ul><ul id="f41abe81-ca9c-4f26-a9ca-d61664ac0db3" class="bulleted-list"><li style="list-style-type:disc">log/<p id="67d33ddb-873e-4a0c-9e0e-061a4cb0e74e" class="">Logs directory.</p></li></ul><ul id="1bf35fa2-54ab-4e6e-9604-b1d7ce1dd1c9" class="bulleted-list"><li style="list-style-type:disc">plugin/<p id="625bca51-cc06-4a14-89c5-3f1c9b2c8118" class="">Plugins directory. Include the middleware modules.</p></li></ul><ul id="43624f7f-b95c-46d8-a26e-caee48826bd8" class="bulleted-list"><li style="list-style-type:disc">processed/<p id="7f4d1c3a-7bff-438a-a601-dc7c813a131e" class="">The directory holds the tasks’ processed records. Each task processed record file (we call it processed_db) corresponds to a transfer task and is named after the uuid of the corresponding task.</p><p id="c6f5306c-4889-4e5d-9656-47e9d04b4b0e" class="">Each processed_db file is an SQLite database that holds information about the source files that have been processed.</p></li></ul><ul id="0d46cc67-8b58-4f77-ba12-a76320e8af7f" class="bulleted-list"><li style="list-style-type:disc">test.py, pytest.ini, pytests/<p id="d8e71de7-2d20-4aa7-a1bc-6febe1492ae9" class="">Directory and files for unit test.</p></li></ul><ul id="f78c3387-3a79-4dac-81d1-100a428ce4f5" class="bulleted-list"><li style="list-style-type:disc">requirements.txt<p id="84da424c-1841-437f-84e0-7bb3ea6a4678" class="">Dependency libraries.</p></li></ul><ul id="75fc0b2f-34dd-4b95-bb90-7ccd318939f0" class="bulleted-list"><li style="list-style-type:disc">linux.spec, macOS.spec, win64.spec<p id="bfe05ae4-ce62-42dd-a5b6-f3d8338723cf" class="">Pyinstaller’s specification files for packaging the program in different operating systems.</p></li></ul><h2 id="61f1b171-7a58-4862-b2fe-44a71e9b6659" class="">transfer_dog Package</h2><p id="cf42515c-db0f-4a39-b943-7f4bf69fe1ac" class="">transfer_dog is the GUI framework of the program, mainly responsible for:</p><ol type="1" id="d259b1ee-d18b-408c-80fe-6d9928f25dea" class="numbered-list" start="1"><li>adding, deleting, checking, and changing transfer tasks. </li></ol><ol type="1" id="716857c9-0494-4676-9a55-bb08db2bb283" class="numbered-list" start="2"><li>start and stop task subprocess manually.</li></ol><ol type="1" id="f200f219-44b3-453d-8322-dc3dbf747ea6" class="numbered-list" start="3"><li>displaying the running status of the task and processed records.</li></ol><ol type="1" id="f5896925-88b6-4d4e-ab18-b8ed5d3c1ed3" class="numbered-list" start="4"><li>scheduling the tasks according to their schedules and starting worker subprocesses.</li></ol><h3 id="9b957101-b8ea-4338-9f57-e8570f977da2" class="">Multi-Language</h3><p id="9e5cc1ef-2b62-4398-afea-31b935db2823" class="">The source file .ts and the binary file .qm for multilingual translation are placed in the <code>transfer_dog/resource/i18n/</code> directory. the TransferDog program will automatically scan the .qm files in this directory and then you can choose which language you want to use in the settings dialog.</p><p id="9c2b28d0-9779-4c99-be83-e7d582f417e0" class="">If you want to add your own language file, you can follow the steps below:</p><ol type="1" id="700a2c85-0239-4053-80b7-e641e519aa50" class="numbered-list" start="1"><li>Use the <code>pyside6-lupdate</code> command to generate the .ts file.<p id="7494acfd-4402-43bf-8513-abadaceb0931" class=""><code>pyside6-lupdate -no-obsolete designer/* transfer_dog/view/* -ts transfer_dog/resource/i18n/lang.ts</code></p></li></ol><ol type="1" id="9eefafa2-b91f-4189-b032-a65f742f93a1" class="numbered-list" start="2"><li>Use the Qt Linguist tool to edit the strings to be translated in the .ts file.<p id="178aa7e0-cb19-478c-88cb-1e11dfcd7092" class="">(Of course, you can also use any text editor tool to edit it directly, since a .ts file is essentially an XML file.)</p></li></ol><ol type="1" id="a695a4f4-ba8d-48a8-916b-607c51ff43b7" class="numbered-list" start="3"><li>Use the <code>pyside6-lrelease</code> command to compile the .ts file into the binary file .qm.<p id="1cc91630-e90a-4f39-a287-424bcfa1d0ac" class=""><code>pyside6-lrelease transfer_dog/resource/i18n/lang.ts -qm transfer_dog/resource/i18n/lang.qm</code></p><p id="bbe0fc08-5d59-47e3-be46-88bba0072c3a" class="">(You can also compile the .ts file into a .qm file directly using the “File - Release” menu of the Qt Linguist tool.)</p></li></ol><ol type="1" id="6a6d0f66-ec2b-4886-b4ca-020d0dd68104" class="numbered-list" start="4"><li>Make sure that the generated .qm file is saved in the <code>transfer_dog/resource/i18n/</code> directory.</li></ol><h3 id="14f0ad88-126a-4702-87d4-069d83227c82" class="">Themes</h3><p id="5aa0a9a9-10e5-4535-bf56-ef8395d9cd8d" class="">We save the program&#x27;s theme file in the <code>transfer_dog/resource/qss/</code> directory. transferDog automatically scans this directory for .qss files, and then you can select the theme you want to use in the settings dialog. You can also write your own theme file and save it in this directory.</p><p id="0065713c-ea80-479a-9170-5c67fec85cac" class="">For more information about writing a QSS file, please refer to <a href="https://doc.qt.io/qt-6/stylesheet.html">https://doc.qt.io/qt-6/stylesheet.html</a>.</p><h2 id="3d7d340f-696f-4f05-91cc-b0096d00fa9b" class="">transfer_worker Pacakge</h2><p id="511c7ddc-64c5-40ac-8dbd-7e7a7ff71c6d" class="">transfer_worker package is responsible for the actual execution of the transfer task. It can run independently of the transfer_dog package (GUI), just run in the command line.</p><h3 id="e35f3c78-81aa-4abf-9224-c9bd2c95e16f" class="">Execution Logic</h3><ul id="34c23c52-6d5c-477b-8dd0-de0a54c0569c" class="bulleted-list"><li style="list-style-type:disc">The <strong>Getter</strong> object is responsible for filtering and downloading the source file and generating the MiddleFile object.</li></ul><ul id="fa5f8e7d-cff3-4344-a0bc-7e31a7aedffc" class="bulleted-list"><li style="list-style-type:disc">The <strong>MiddleFile</strong> object is responsible for saving the state of the temporary file. It includes the temporary file itself, and the corresponding paths of source file and destination file.</li></ul><ul id="d2c029a8-91c6-4468-b830-bd7a60c4f589" class="bulleted-list"><li style="list-style-type:disc">The <strong>Putter</strong> object is responsible for uploading the temporary file in the MiddleFile object and generating the target file in the destination address. </li></ul><ul id="4af103fd-796f-4dd7-a67f-e803ba10fb4d" class="bulleted-list"><li style="list-style-type:disc">The <strong>middleware</strong> is responsible for the middle process of MiddleFile. The logic of file download/upload can be changed by middleware.</li></ul><p id="2e62ea7d-328b-4a64-95ce-7dac681104ec" class="">
</p><p id="88a16df7-c26d-474e-b792-462f838245c4" class="">The whole execution process of a transfer worker can be simplified as follows:</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="f785b7ab-65f0-44d6-9c90-46b97f83235e"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><mark class="highlight-red">Getter filtering &gt; middleware.pre_process for pre-processing &gt; Getter downloading &gt; middleware.process for post-processing &gt; Putter uploading</mark></div></figure><p id="7e5b5040-966b-4b22-9f8f-b792c3cddc87" class="">Details：</p><ol type="1" id="5c4e7f5e-69a2-4d6b-b800-68e33e1a4a27" class="numbered-list" start="1"><li>When the task starts, TransferDog creates the corresponding getter and putter objects according to the source and target, and check the validity.</li></ol><ol type="1" id="8d8fce2f-f52b-4c80-8a73-37b5f9f2284d" class="numbered-list" start="2"><li>getter.next() gets the next file that need to be transferred:<ol type="a" id="f0b13b4c-d462-471b-a82b-ac01231c27a5" class="numbered-list" start="1"><li>Traverse the source directory.</li></ol><ol type="a" id="1f15a3ec-241f-4934-95ff-c41f2c55e3d6" class="numbered-list" start="2"><li>Check the source file’s update time is not in the interval (constants.IGNORE_MTIME_IN_SECONDS).</li></ol><ol type="a" id="58296042-69ee-4a5a-8397-893302b4172d" class="numbered-list" start="3"><li>Check the source file name matches the regular expression.</li></ol><ol type="a" id="a55fbd94-d536-4f9a-8262-f034938f036a" class="numbered-list" start="4"><li>Check the <mark class="highlight-red">(source_file, mtime)</mark> already exists in the processed_db file.</li></ol><ol type="a" id="e2c3e719-41a4-40c5-9e2b-78ce59ed3b9f" class="numbered-list" start="5"><li>return a mid_file = MiddleFile(source_file path, source_file_modification_time), where the source_file path is a relative path to the source address (task.source.path) in the task configuration.</li></ol></li></ol><ol type="1" id="10483df7-983b-4be2-8bca-fd36867a8080" class="numbered-list" start="3"><li>middleware.pre_process() performs pre-processing.<p id="84a2fb35-79fc-4707-8c4b-5f61fd5d6e06" class="">You can add filtering rules that can&#x27;t be implemented using only regular matching, you can use it to modify the target file path, and you can modify the mid_file.abort property to specify whether to perform subsequent processing or not on the source file.</p></li></ol><ol type="1" id="5198ad36-04f2-49a2-8380-b5f04c9168ee" class="numbered-list" start="4"><li>getter.get() downloads the file and generates the mid_file.middle temporary file.<p id="d39c1556-e8b5-45bc-9018-3c861dc9c228" class="">If the source file size is very small, it will not generate a middle file, mid_file.middle refers to a BytesIO object in memory.</p><p id="6028f9b6-c3c9-4464-86da-19a3637da3a4" class="">If the source file size is large, the intermediate file is generated, and mid_file.middle points to the full path (a pathlib.Path object) of the intermediate file.</p><p id="fa514f59-6ff6-4826-b78f-cc08055fe0a4" class="">The value of this standard size is specified by constants.MIDDLE_FILE_THRESHOLD.</p></li></ol><ol type="1" id="74e9b9f4-23b6-4e73-9e5c-c815f0f0a422" class="numbered-list" start="5"><li>middleware.process() performs post-processing.</li></ol><ol type="1" id="efc514aa-72c8-40ba-afed-94d200370cca" class="numbered-list" start="6"><li>putter.put(mid_file) uploads the temporary file to the destination path.</li></ol><ol type="1" id="e8cdf851-a75e-49cc-a2fd-1350287c68f2" class="numbered-list" start="7"><li>Delete the source file and clean up the temporary files.</li></ol><h2 id="7087254c-99b7-414e-98eb-4de64cf4a81e" class="">Middleware Developing</h2><pre id="23cf8b51-6042-434a-9b14-240b89d42861" class="code"><code>import logging

from transfer_worker.worker.middle_file import Abort, MiddleFile

DESCRIPTION = &quot;&quot;&quot;中间件示例
你可以通过自己编写的中间件脚本来修改 TransferWorker 的传输逻辑。

有效的中间件应该可选地包含两个函数: pre_process(mid_file, arg) 与 process(mid_file, arg).

你可以在中间件函数中决定目标文件的文件路径，决定是否中止传输，甚至通过 mid_file.middle 修改上传的文件内容。

参数 mid_file 代表处于 下载 &gt;&gt; 上传 中间状态的临时文件。TransferWorker 从源地址下载源文件，形成 mid_file, 然后将 mid_file 上传到目标地址。
    MiddleFile {
        source:         源文件的相对路径, Path 类型
        source_mtime:   源文件的文件修改时间, str 类型
        middle:         临时文件, Path 类型或者字节流类型
        dest:           目标文件的相对路径, Path 类型
        abort:          是否中止后续操作, middle_file.Abort 枚举。包括 Abort.ABORT, Abort.NO_ABORT, Abort.ABORT_AND_RECORD。
                        三个枚举值分别表示 中止、不中止、中止并记录为已处理。默认为 NO_ABORT。
    }

参数 arg 是由任务配置中的 task.middleware_arg 字段传递的。两个函数共享该字段，由你自己决定如何划分该参数。
    比如你可以决定 arg.split(&#x27;,&#x27;)[0] 给 pre_process 用， arg.split(&#x27;,&#x27;)[1] 给 process() 用。

&quot;&quot;&quot;

def pre_process(mid_file: MiddleFile, arg: str) -&gt; None:
    &quot;&quot;&quot;TransferWorker 在过滤出待处理的源文件之后，准备下载该源文件之前，会尝试调用中间件的 pre_process() 函数。

    此时的 mid_file 只有 {source, source_mtime, abort} 属性
    
    你可以在 pre_process() 中设置 mid_file 的 dest 与 abort 属性

    Args:
        mid_file (MiddleFile): _description_
        arg (str): _description_
    &quot;&quot;&quot;
    logger = logging.getLogger(__name__)
    logger.debug(&#x27;Just do nothing.&#x27;)
    pass

def process(mid_file: MiddleFile, arg: str) -&gt; None:
    &quot;&quot;&quot;TransferWorker 在下载完源文件，生成 mid_file.middle 之后，准备上传该 mid_file 之前，会尝试调用中间件的 process() 函数。
    
    此时的 mid_file 只有 {source, source_mtime, middle, abort 属性}

    你可以在 process() 中设置 mid_file 的 dest 与 abort 属性。甚至修改 mid_file.middle 临时文件的内容。

    Args:
        mid_file (MiddleFile): _description_
        arg (str): _description_
    &quot;&quot;&quot;
    logger = logging.getLogger(__name__)
    logger.debug(&#x27;Just do nothing.&#x27;)
    pass</code></pre><h1 id="7e11a031-753d-4f5d-8904-43fc34db4e43" class="">🎁 Thanks to</h1><h2 id="570f86ed-cb43-4877-aeac-ffb31285b11d" class="">Third-party Libraries</h2><ul id="a1f1a700-5868-4747-9bdd-529e61ab5f73" class="bulleted-list"><li style="list-style-type:disc"><a href="https://pypi.org/project/PySide6/">PySide6</a> for GUI</li></ul><ul id="65505a05-f395-4a93-b1ff-ee369df4c959" class="bulleted-list"><li style="list-style-type:disc"><a href="https://www.sqlite.org/index.html">SQLite</a> for Database</li></ul><ul id="d1fb053d-87b6-4501-9d7e-5eec27b668c5" class="bulleted-list"><li style="list-style-type:disc"><a href="https://github.com/coleifer/peewee">peewee</a> for ORM</li></ul><ul id="c5923209-077f-4491-ba4c-9f04c9411690" class="bulleted-list"><li style="list-style-type:disc"><a href="https://github.com/paramiko/paramiko">Paramiko</a> for SFTP</li></ul><ul id="bd8e917a-1797-42ee-aaa6-1ff87585b4df" class="bulleted-list"><li style="list-style-type:disc"><a href="https://github.com/kiorky/croniter">croniter</a> for scheduling task</li></ul><h2 id="29331f64-247f-4c2e-b44f-22287bcc2f4e" class="">Resource files</h2><ul id="d7129613-6dab-4dfc-a024-849350147f2c" class="bulleted-list"><li style="list-style-type:disc"><a href="https://remixicon.com/">remixicon</a> for Icon</li></ul><ul id="5a7c519e-06c5-4129-9095-3346926a48ff" class="bulleted-list"><li style="list-style-type:disc"><a href="https://www.flaticon.com/icon-fonts-most-downloaded/2?weight=bold&amp;corner=rounded&amp;type=uicon">flaticon</a> for Icon</li></ul><ul id="27c39917-73b1-4d25-905a-e54f17e6d91d" class="bulleted-list"><li style="list-style-type:disc"><a href="https://loading.io/">loading.io</a> for GIF</li></ul><p id="157ec503-88a7-463a-95b5-24158329e9eb" class="">
</p><h1 id="06d96695-d53b-408f-b70b-a70cb3ddb60b" class="">📝 Todo list</h1><ul id="aedeb1ec-bfdb-4fbf-8d07-cd42174533f4" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked">We use the Paramiko library for SFTP, but it does not currently support non-UTF8 encoded servers.</span><div class="indented"></div></li></ul><ul id="3cb10a98-6e2d-4ff5-bdc7-7132fe8fced6" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked">HTTP downloading (uploading is not in the plan, because HTTP uploads are too server related)</span><div class="indented"></div></li></ul><ul id="dd288408-78ad-4a83-83c4-c2f5b8088307" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked">Can choose to match the full path or just the file name when filtering the source file. (Now the default is to match the full path)</span><div class="indented"></div></li></ul><p id="c9d00a1a-b2bb-4a90-9d69-cda503fb2fdf" class="">
</p></div></article></body></html>